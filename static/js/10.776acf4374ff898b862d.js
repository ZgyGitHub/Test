webpackJsonp([10],{HKYh:function(t,e,i){t.exports=i.p+"static/img/AI_avatar.05493f9.png"},Rugk:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("kMOI"),s=i("GyW3"),a=i("uhc6"),n=i.n(a),r=i("75UI"),c=i("//Fk"),h=i.n(c),l=i("mtWM"),g=i.n(l),u=i("Fwkz"),m=i("UBjx"),p=i("bh5B"),d=i("woOf"),f=i.n(d),v={props:{data:{type:Array,default:[]},config:{type:Object,default:null}},data:function(){return{option:{radius:120,maxFont:24,color:null,rotateAngleXbase:600,rotateAngleYbase:600,hover:!0},tagList:[]}},created:function(){null!=this.config&&(this.option=f()({},this.option,this.config))},mounted:function(){this._initTags()},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},watch:{data:function(){var t=this;this.$nextTick(function(){t._initTags()})}},methods:{_initTags:function(){if(this.rotateAngleX=Math.PI/this.option.rotateAngleXbase,this.rotateAngleY=Math.PI/this.option.rotateAngleYbase,this.option.hover){var t=this;this.$refs.wrapper.onmousemove=function(e){t.rotateAngleY=(e.pageX-this.offsetLeft-this.offsetWidth/2)/1e4,t.rotateAngleX=-(e.pageY-this.offsetTop-this.offsetHeight/2)/1e4}}else this.$refs.wrapper.onmousemove=null;for(var e=0,i=this.data.length;e<i;e++){var o=Math.acos((2*(e+1)-1)/i-1),s=o*Math.sqrt(i*Math.PI),a=this.option.radius*Math.sin(o)*Math.cos(s),n=this.option.radius*Math.sin(o)*Math.sin(s),r=this.option.radius*Math.cos(o);this.option.color?this.$refs.tag[e].style.color=this.option.color:this.$refs.tag[e].style.color="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")";var c={x:a,y:n,z:r,ele:this.$refs.tag[e]};this.tagList.push(c)}var h=this;this.timer=setInterval(function(){for(var t=0;t<h.tagList.length;t++)h.rotateX(h.tagList[t]),h.rotateY(h.tagList[t]),h.setPosition(h.tagList[t],h.option.radius,h.option.maxFont)},20)},setPosition:function(t,e,i){this.$refs.wrapper&&(t.ele.style.transform="translate("+(t.x+this.$refs.wrapper.offsetWidth/2-t.ele.offsetWidth/2)+"px,"+(t.y+this.$refs.wrapper.offsetHeight/2-t.ele.offsetHeight/2)+"px)",t.ele.style.opacity=t.z/e/2+.7,t.ele.style.fontSize=(t.z/e/2+.5)*i+"px")},rotateX:function(t){var e=Math.cos(this.rotateAngleX),i=Math.sin(this.rotateAngleX),o=t.y*e-t.z*i,s=t.y*i+t.z*e;t.y=o,t.z=s},rotateY:function(t){var e=Math.cos(this.rotateAngleY),i=Math.sin(this.rotateAngleY),o=t.z*i+t.x*e,s=t.z*e-t.x*i;t.x=o,t.z=s},dbclickTag:function(){if(this.timer)clearInterval(this.timer),this.timer=null;else{var t=this;this.timer=setInterval(function(){for(var e=0;e<t.tagList.length;e++)t.rotateX(t.tagList[e]),t.rotateY(t.tagList[e]),t.setPosition(t.tagList[e],t.option.radius,t.option.maxFont)},20)}},clickItem:function(t){this.$emit("clickItem",t)}}},T={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"wrapper",staticClass:"tag-cloud"},t._l(t.data,function(e,o){return i("p",{key:o,ref:"tag",refInFor:!0,on:{click:function(i){t.clickItem(e)},dblclick:function(i){t.dbclickTag(e)}}},[t._v(t._s(e.name))])}))},staticRenderFns:[]};var w=i("VU/8")(v,T,!1,function(t){i("bYb/")},"data-v-21699662",null).exports,y=i("HKYh"),x=i.n(y),_=i("EdC7"),b=i.n(_),C={name:"ChatAI",data:function(){return{mainHeight:"",inputContent:"",softHeight:0,statusBarHeight:20,marginBottom:0,chatMsgList:[],currentCategory:"",categoryList:[],hotTag:["凯里市","从江县","台江县","剑河县","丹寨县","榕江县","施秉县","镇原县"],chatIcon:n.a,voiceToast:{imgs:[],text:""},showToast:!1,showVoice:!1,showTag:!1}},created:function(){var t=this;this.inputWidth=window.innerWidth-55-24-12,Object(s.c)()?(this.statusBarHeight=44,this.marginBottom=34,this.topHeight=74):this.topHeight=60,window._Native_heightChange=function(e,i){var o=e/window.innerHeight;(e-i)/o<=t.statusBarHeight?(t.softHeight=0,t.$refs.top.$el.style.marginTop="0",Object(s.c)()&&(t.marginBottom=34)):(t.marginBottom=0,Object(s.b)()?t.softHeight=(e-i)/o:t.softHeight=(e-i)/o-t.statusBarHeight,t.showEmotion=!1),t.computedMainHeight()},this.voiceToast={imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"按住  说话",type:"normal"},this._getTagCategory()},mounted:function(){var t=this;this.autoTextarea(90,0),setTimeout(function(){t.$nextTick(function(){t.computedMainHeight(!0)})},300),this.chatMsgList.push({id:"xiaohai",type:"from",content:"我是小嗨，为您解决出行烦恼",nickname:"小嗨",headUrl:x.a,sendTime:(new Date).getTime()})},components:{VHeader:m.a,Scroll:p.a,TagCloud:w},methods:{_getTagCategory:function(){var t=this;u.a.get(this,"/v1/intelligenceCategory",{pageSize:10},function(e){t.categoryList=e,t.currentCategory=e[0].id,t._getHotTag()})},_getHotTag:function(){var t=this;u.a.get(this,"/v1/intelligenceTag/"+this.currentCategory,null,function(e){t.hotTag=e})},clickCategory:function(t){this.currentCategory=t,this._getHotTag()},contentFocus:function(t){Object(s.b)()&&(this.$refs.bottom.style.position="fixed");var e=this;this.heightTimer=setInterval(function(){e.computedMainHeight()},200)},contentBlur:function(){clearInterval(this.heightTimer)},computedMainHeight:function(t){var e=this;this.$refs.bottom.style.position="relative",this.$refs.bottom.scrollIntoView(),this.$refs.bottom.scrollIntoViewIfNeeded(),this.$refs.bottom.style.bottom="0",this.mainHeight=window.innerHeight-this.$refs.top.$el.clientHeight-this.$refs.bottom.clientHeight-this.softHeight-this.marginBottom;var i=300;t&&(i=0),this.$nextTick(function(){e.$refs.scroll&&(e.$refs.scroll.$el.style.marginTop=e.$refs.top.$el.clientHeight+"px",setTimeout(function(){e.$refs.scroll&&(e.$refs.scroll.scroll.refresh(),e.$refs.scroll.scroll.scrollTo(0,e.$refs.scroll.scroll.maxScrollY,i))},i))})},sendMessage:function(){var t=this;if(""!==this.inputContent){var e=this.inputContent;this.inputContent="",this.$refs.textarea.focus();var i=o.b.get();null==i&&(i={}),this.chatMsgList.push({id:i.id||"",type:"to",content:e,nickname:i.nickname||"",headUrl:i.headUrl||b.a,sendTime:(new Date).getTime()});var s,a,n,r,c=this;(s=e,a="",n=i.id||"",r={key:"5ab30db5cd734e099b7e5687a33377e9",info:s,loc:a,userid:n},new h.a(function(t,e){g()({method:"POST",url:"http://www.tuling123.com/openapi/api",params:r,headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(i){console.log(i),1e5===i.data.code?t(i.data.text):e(new Error("不支持该格式的返回结果"))})})).then(function(t){c.chatMsgList.push({id:"xiaohai",type:"from",content:t,nickname:"小嗨",headUrl:x.a,sendTime:(new Date).getTime()})}).catch(function(e){t.$vux.toast.text(e.message,"middle")})}},autoTextarea:function(t,e){var i=this.$refs.textarea;e=e||0;var o=!!document.getBoxObjectFor||"mozInnerScreenX"in window,s=!!window.opera&&!!window.opera.toString().indexOf("Opera"),a=function(t,e){i.addEventListener?i.addEventListener(t,e,!1):i.attachEvent("on"+t,e)},n=i.currentStyle?function(t){var e=i.currentStyle[t];if("height"===t&&1!==e.search(/px/i)){var o=i.getBoundingClientRect();return o.bottom-o.top-parseFloat(n("paddingTop"))-parseFloat(n("paddingBottom"))+"px"}return e}:function(t){return getComputedStyle(i,null)[t]};i.style.resize="none";var r=function(){var a=void 0,r=0,c=i.style;i._length!==i.value.length&&(i._length=i.value.length,o||s||(r=parseInt(n("paddingTop"))+parseInt(n("paddingBottom"))),i.style.height="40px",i.scrollHeight>40&&(t&&i.scrollHeight>t?(a=t-r,c.overflowY="auto"):(a=i.scrollHeight-r,c.overflowY="hidden"),c.height=a+e+"px",i.currHeight=parseInt(c.height)))};a("propertychange",r),a("input",r),a("focus",r),r()},press:function(){var t=this;this.recordTimer&&(clearTimeout(this.recordTimer),this.recordTimer=null),this.showToast=!0,this.voiceToast={type:"normal",imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"松开  结束"},this.startRecordTime=new Date,r.a.recognizerVoice(function(e){t.inputContent+=e,t.showVoice=!1},function(e){e=Math.ceil((e+5)/5),!t.showToast||"normal"!==t.voiceToast.type&&"listen"!==t.voiceToast.type||(t.voiceToast={type:"listen",imgs:[n.a.recorder,n.a["v"+e]],text:"手指上划，取消发送",button:"松开  结束"})})},pan:function(t){t.distance>120?this.voiceToast={type:"cancel",imgs:[this.chatIcon.cancel],text:"松开手指，取消发送",button:"松开手指，取消发送"}:this.voiceToast={type:"listen",imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"松开  结束"},t.isFinal&&(this.showToast=!1,t.distance<=120?(this.sendMessage(),r.a.stopRecognizerVoice(),this.toggleInput()):r.a.cancelRecognizerVoice(),this.voiceToast={type:"normal",imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"按住  说话"})},pressup:function(){var t=this;this.moment().diff(this.moment(this.startRecordTime))<1e3?(this.voiceToast={type:"tooShort",imgs:[n.a.voice_to_short],text:"录制时间太短",button:"松开  结束"},this.recordTimer=setTimeout(function(){t.showToast=!1,t.voiceToast={type:"normal",imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"按住  说话"}},1e3)):(r.a.stopRecognizerVoice(),this.sendMessage(),this.showToast=!1,this.voiceToast={type:"normal",imgs:[n.a.recorder,n.a.v1],text:"手指上划，取消发送",button:"按住  说话"},this.toggleInput())},toggleInput:function(){this.showVoice=!this.showVoice,this.showVoice||this.$refs.textarea.focus()},clickTagItem:function(t){this.inputContent=t.name,this.showTag=!1,this.sendMessage()}},watch:{chatMsgList:function(t,e){var i=this;t.forEach(function(e,o){i.moment().diff(i.moment(e.sendTime),"days")<=1?e.sendTimeStr=i.moment(e.sendTime).format("HH:mm"):e.sendTimeStr=i.moment(e.sendTime).format("YYYY-MM-DD HH:mm"),o>0&&i.moment(e.sendTime).diff(i.moment(t[o-1].sendTime),"minutes")<4&&(e.sendTimeStr="")});var o=t[t.length-1];"from"===o.type&&r.a.speechVoice(o.content)}},beforeDestroy:function(){r.a.stopSpeechVoice()}},H={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat-wrapper"},[i("v-header",{ref:"top",attrs:{title:"智能机器人",fixed:!0}}),t._v(" "),i("div",{staticStyle:{position:"relative"},style:{height:t.mainHeight+"px",marginTop:t.topHeight+"px"}},[i("scroll",{directives:[{name:"show",rawName:"v-show",value:!t.showTag,expression:"!showTag"}],ref:"scroll",staticStyle:{overflow:"hidden",height:"100%"},attrs:{data:t.chatMsgList}},[i("ul",{staticClass:"message"},t._l(t.chatMsgList,function(e,o){return i("li",{key:o,class:e.type},[""!==e.sendTimeStr?i("p",{staticClass:"time"},[i("span",[t._v(t._s(e.sendTimeStr))])]):t._e(),t._v(" "),i("div",{staticClass:"main"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.headUrl,expression:"msg.headUrl"}],staticClass:"avatar"}),t._v(" "),i("div",{staticClass:"text",domProps:{innerHTML:t._s(e.content)}})])])}))]),t._v(" "),t.showTag?i("div",{staticStyle:{position:"relative",height:"100%"}},[i("tag-cloud",{attrs:{data:t.hotTag},on:{clickItem:t.clickTagItem}}),t._v(" "),i("div",{staticClass:"tags"},t._l(t.categoryList,function(e){return i("p",{key:e.id,class:{active:e.id===t.currentCategory},on:{click:function(i){t.clickCategory(e.id)}}},[t._v(t._s(e.name))])}))],1):t._e()],1),t._v(" "),i("div",{ref:"bottom",staticClass:"bottom"},[i("div",{staticStyle:{display:"flex"}},[i("div",{staticClass:"icon",on:{click:t.toggleInput}},[i("i",{directives:[{name:"show",rawName:"v-show",value:!t.showVoice,expression:"!showVoice"}],staticClass:"fa fa-microphone",attrs:{"aria-hidden":"true"}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.showVoice,expression:"showVoice"}],staticClass:"fa fa-keyboard-o",attrs:{"aria-hidden":"true"}})]),t._v(" "),i("v-touch",{directives:[{name:"show",rawName:"v-show",value:t.showVoice,expression:"showVoice"}],staticClass:"voiceInput",class:{voiceInputActive:"normal"!==t.voiceToast.type},style:{width:t.inputWidth+"px"},on:{press:t.press,pressup:t.pressup,pan:t.pan}},[t._v(t._s(t.voiceToast.button))]),t._v(" "),i("textarea",{directives:[{name:"show",rawName:"v-show",value:!t.showVoice,expression:"!showVoice"},{name:"model",rawName:"v-model.trim",value:t.inputContent,expression:"inputContent",modifiers:{trim:!0}}],ref:"textarea",staticClass:"input",style:{width:t.inputWidth+"px"},domProps:{value:t.inputContent},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.sendMessage(e)},focus:t.contentFocus,blur:[t.contentBlur,function(e){t.$forceUpdate()}],input:function(e){e.target.composing||(t.inputContent=e.target.value.trim())}}}),t._v(" "),""!=t.inputContent?i("div",{staticClass:"icon iconActive",on:{click:t.sendMessage}},[i("i",{staticClass:"fa fa-paper-plane-o",attrs:{"aria-hidden":"true"}})]):t._e(),t._v(" "),""==t.inputContent?i("div",{staticClass:"icon",on:{click:function(e){t.showTag=!t.showTag}}},[i("i",{staticClass:"fa fa-bars",class:{tagActive:t.showTag},attrs:{"aria-hidden":"true"}})]):t._e()],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showToast,expression:"showToast"}],staticClass:"toast"},[i("div",{staticClass:"img"},t._l(t.voiceToast.imgs,function(t,e){return i("img",{key:e,attrs:{src:t}})})),t._v(" "),i("p",{class:{cancel:"cancel"===t.voiceToast.type}},[t._v(t._s(t.voiceToast.text))])])],1)},staticRenderFns:[]};var M=i("VU/8")(C,H,!1,function(t){i("qHlQ")},"data-v-9e7444e2",null);e.default=M.exports},"bYb/":function(t,e){},qHlQ:function(t,e){},uhc6:function(t,e){t.exports={recorder:"./static/img/chat/recorder.png",v1:"./static/img/chat/v1.png",v2:"./static/img/chat/v2.png",v3:"./static/img/chat/v3.png",v4:"./static/img/chat/v4.png",v5:"./static/img/chat/v5.png",v6:"./static/img/chat/v6.png",v7:"./static/img/chat/v7.png",cancel:"./static/img/chat/cancel.png",voice_to_short:"./static/img/chat/voice_to_short.png",loading:"./static/img/chat/loading.gif"}}});
//# sourceMappingURL=10.776acf4374ff898b862d.js.map