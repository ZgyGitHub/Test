webpackJsonp([34],{LbXi:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("aFK5"),a=i.n(s),r=i("Dd8w"),l=i.n(r),n=i("UBjx"),o=i("GyW3"),c=i("Fwkz"),d=i("fkWs"),h=i("MdvP"),u=i.n(h),p=i("bh5B"),m=i("XVGx"),g=i("odqc"),v=i("Znkm"),f=i("e66H"),H=i("63CM"),y=i.n(H),_=i("HD9R"),C=i("Msp2"),w=i("NYxO"),k={data:function(){return{icon:u.a,showUserList:!1,showMap:!1,showCancel:!0,menusMap:{},enabledWrapperTouch:!0,markerList:null,map:null,allTypes:[{type:"",label:"全部",markerStyle:"marker0",color:"red"},{type:1,label:"景点",markerStyle:"marker1",color:"green"},{type:0,label:"酒店",markerStyle:"marker0",color:"red"}],currentType:"",scrollHeight:0,selectProduct:null,userList:[],dynamicList:[],productList:[]}},computed:l()({},Object(w.b)(["currentArea"])),directives:{TransferDom:y.a},components:{VHeader:n.a,Popup:_.a,Scroll:p.a,Tab:g.a,TabItem:v.a,Rater:f.a,Waterfall:m.a,Actionsheet:C.a},created:function(){this.itemWidth=window.innerWidth/2-23,this.middleHeight=window.innerHeight/2-60,this.paddingBottom=0,Object(o.c)()?(this.paddingBottom=34,this.maxHeight=window.innerHeight-34-120):this.maxHeight=window.innerHeight-20-120,this.listHeight="auto"},mounted:function(){this.initMap()},beforeDestroy:function(){this.map&&this.map.destroy(),this.timmer&&clearInterval(this.timer)},methods:{_getProductList:function(){var t=this;c.a.get(this,"/v1/productReserve/"+this.$route.params.addressId,{type:this.currentType},function(e){t.productList=e,t.markerList.render(e)})},_getUsers:function(){var t=this,e=this;c.a.get(this,"/v1/users/"+this.selectProduct.productId,{pageSize:10},function(i){i.forEach(function(i){var s=i.effectiveDate.split("~")[0];if(i.toTime=e.moment().to(s),0===i.type&&t.moment().isAfter(s)){var a=i.effectiveDate.split("~")[1];t.moment().isBefore(a)&&(i.toTime="正在住宿")}}),e.userList=i})},_getDynamic:function(){var t=this,e=this;c.a.get(this,"/v1/dynamic",{productId:this.selectProduct.productId,pageSize:10},function(i){i.forEach(function(e){e.src=e.atlas?e.atlas.split(";")[0]+"-w350":"",e.publishTime=t.moment(e.publishTime).format("YYYY年MMMDo")}),e.dynamicList=i})},initMap:function(){this.map=new AMap.Map("container",{resizeEnable:!0,center:[this.currentArea.longitude,this.currentArea.latitude],zoom:10,zooms:[6,15]}),this.map.addControl(new AMap.Scale);var t=this;t.map.on("click",function(){t.hiddenScroll()}),AMapUI.loadUI(["misc/MarkerList","overlay/SvgMarker"],function(e,i){var s=new e({map:t.map,getPosition:function(t){return[t.longitude,t.latitude]},getDataId:function(t,e){return t.productId},getMarker:function(e,s,a){var r=e.reserveCount<10?e.reserveCount+"":"",l=t.allTypes.find(function(t){return t.type===e.type});null==l&&(l=t.allTypes[0]);var n=new i.Shape.Circle({radius:14,fillColor:"white",strokeWidth:1,strokeColor:l.color});return a?(a.setSvgShape(n),a.setContainerClassNames(l.markerStyle),void a.setIconLabel(r)):new i(n,{map:t.map,containerClassNames:l.markerStyle,iconStyle:l.color,iconLabel:r})},getInfoWindow:function(t,e,i){return null},autoSetFitView:!0});t.markerList=s,t._getProductList(),s.on("selectedChanged",function(e,s){if(s.selected&&(t.selectProduct=s.selected.data,0===t.scrollHeight&&(t.scrollHeight=t.middleHeight),s.selected.marker)){var a=s.selected.data,r=a.reserveCount<20?a.reserveCount+"":"",l=t.allTypes.find(function(t){return t.type===a.type});null==l&&(l=t.allTypes[0]);var n=new i.Shape.WaterDrop({height:48,fillColor:"white",strokeWidth:1,strokeColor:l.color});s.selected.marker.setSvgShape(n),s.selected.marker.setIconLabel(r),s.selected.marker.setContainerClassNames(l.markerStyle+"_selected")}if(s.unSelected&&s.unSelected.marker){var o=s.unSelected.data,c=o.reserveCount<10?o.reserveCount+"":"",d=t.allTypes.find(function(t){return t.type===o.type});null==d&&(d=t.allTypes[0]);var h=new i.Shape.Circle({radius:12,fillColor:"white",strokeWidth:1,strokeColor:d.color});s.unSelected.marker.setSvgShape(h),s.unSelected.marker.setIconLabel(c),s.unSelected.marker.setContainerClassNames(d.markerStyle)}}),s.on("renderComplete",function(t,e){})})},position:function(){this.map.setCenter([this.currentArea.longitude,this.currentArea.latitude])},changeType:function(t){this.currentType=this.allTypes[t].type,this.hiddenScroll(),this._getProductList()},hiddenScroll:function(){this.scrollHeight>0&&(this.scrollHeight=0,this.markerList.clearSelected())},scroll:function(t){t.y<0?(this.enabledWrapperTouch=!1,this.scrollHeight=this.maxHeight):this.enabledWrapperTouch||(this.scrollHeight=this.maxHeight,this.panStartHeight=this.maxHeight,this.enabledWrapperTouch=!0)},scrollStart:function(){},scrollEnd:function(){this.enabledWrapperTouch||(this.scrollHeight=this.maxHeight,this.panStartHeight=this.maxHeight,this.enabledWrapperTouch=!0)},onPanstart:function(t){this.panStartHeight=this.scrollHeight},onPanup:function(t){var e=this;this.timer&&clearInterval(this.timer),this.scrollHeight=Math.min(this.panStartHeight+t.distance,this.maxHeight),t.isFinal&&(this.scrollHeight>=(this.maxHeight+this.middleHeight)/2?this.timer=setInterval(function(){e.scrollHeight<e.maxHeight?e.scrollHeight=Math.min(e.scrollHeight+12,e.maxHeight):clearInterval(e.timer)},20):this.timer=setInterval(function(){e.scrollHeight>e.middleHeight?e.scrollHeight=Math.max(e.scrollHeight-12,e.middleHeight):clearInterval(e.timer)},20))},onPandown:function(t){var e=this;this.scrollHeight=Math.max(this.panStartHeight-t.distance,0),t.isFinal&&(this.scrollHeight>=(this.maxHeight+this.middleHeight)/2?this.timer=setInterval(function(){e.scrollHeight<e.maxHeight?e.scrollHeight=Math.min(e.scrollHeight+12,e.maxHeight):clearInterval(e.timer)},20):this.scrollHeight>=this.middleHeight&&this.scrollHeight<(this.maxHeight+this.middleHeight)/2?this.timer=setInterval(function(){e.scrollHeight>e.middleHeight?e.scrollHeight=Math.max(e.scrollHeight-12,e.middleHeight):clearInterval(e.timer)},20):this.scrollHeight<this.middleHeight&&this.scrollHeight>=this.middleHeight/2?this.timer=setInterval(function(){e.scrollHeight<e.middleHeight?e.scrollHeight=Math.min(e.scrollHeight+12,e.middleHeight):clearInterval(e.timer)},20):this.timer=setInterval(function(){e.scrollHeight>0?e.scrollHeight=Math.max(e.scrollHeight-12,0):clearInterval(e.timer)},20))},onSwipeleft:function(){var t=this,e=this.productList.length;if(e>1){var i=this.productList.findIndex(function(e){return e.productId===t.selectProduct.productId});this.selectProduct=0===i?this.productList[e-1]:this.productList[i-1]}},onSwiperight:function(){var t=this,e=this.productList.length;if(e>1){var i=this.productList.findIndex(function(e){return e.productId===t.selectProduct.productId});this.selectProduct=i===e-1?this.productList[0]:this.productList[i+1]}},toDynamicDesc:function(t){this.$router.replace("/meiTu/dynamicDesc/"+t.id)},toUSerDetail:function(t){this.$router.replace("/meiTu/userDynamic/"+t)},toProductDesc:function(){this.$router.replace("/address/product/"+this.selectProduct.productId+"/"+this.selectProduct.type)},goToMap:function(){if(Object(o.b)())window.webkit.messageHandlers.NativeMethod.postMessage({methodName:"openMapNavi",latitude:this.selectProduct.latitude,longitude:this.selectProduct.longitude});else{if(this.menusMap=JSON.parse(window.android.isInstallByread()),null==this.menusMap||1===a()(this.menusMap).length)return this.showCancel=!1,void(this.showGaoDei=!0);"2"===this.menusMap.baiDu&&(this.menusMap.baiDu="百度地图"),"1"===this.menusMap.gaoDei&&(this.menusMap.gaoDei="高德地图"),"3"===this.menusMap.tenXun&&(this.menusMap.tenXun="腾讯地图"),this.showMap=!0}},handleClickMenu:function(t){"baiDu"===t?window.android.makeUpMap(this.selectProduct.latitude,this.selectProduct.longitude,this.selectProduct.address,2,1,""):"gaoDei"===t?window.android.makeUpMap(this.selectProduct.latitude,this.selectProduct.longitude,this.selectProduct.address,1,1,""):"tenXun"===t&&window.android.makeUpMap(this.selectProduct.latitude,this.selectProduct.longitude,this.selectProduct.address,3,1,"")}},watch:{selectProduct:function(){null!=this.selectProduct&&(this.markerList.getSelectedDataId()!==this.selectProduct.productId&&this.markerList.selectByDataId(this.selectProduct.productId),this._getUsers(),this._getDynamic(),this.selectProduct.distanceStr=Object(d.a)(Object(d.b)(this.$store.getters.position,[this.selectProduct.longitude,this.selectProduct.latitude])))},scrollHeight:function(){this.scrollHeight===this.maxHeight?(this.userList.length>0||this.dynamicList.length>0)&&(this.listHeight=this.scrollHeight-138-45+"px"):this.scrollHeight===this.middleHeight?this.listHeight="auto":0===this.scrollHeight&&this.markerList.clearSelected()}}},S={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"map-wrapper"},[i("v-header",{attrs:{title:"偶遇-"+t.currentArea.name,fixed:!0,opacity:.7}},[i("img",{staticClass:"position",attrs:{slot:"right",src:t.icon.position},on:{click:function(e){e.stopPropagation(),t.position(e)}},slot:"right"})]),t._v(" "),i("div",{attrs:{id:"container"}}),t._v(" "),i("div",{staticClass:"footer-wrapper"},[t.selectProduct?i("v-touch",{style:{height:t.scrollHeight+"px"},attrs:{enabled:t.enabledWrapperTouch},on:{panstart:t.onPanstart,panup:t.onPanup,pandown:t.onPandown,swipeleft:t.onSwipeleft,swiperight:t.onSwiperight}},[i("div",{staticClass:"scroll-wrapper"},[i("div",{staticClass:"product"},[i("div",{staticClass:"head"},[i("p",{staticClass:"title"},[t._v(t._s(t.selectProduct.productName))]),t._v(" "),i("p",{staticStyle:{"font-size":"12px",padding:"0px 9px",height:"22px","line-height":"22px",color:"#666",border:"1px solid #666","border-radius":"3px"},on:{click:function(e){e.stopPropagation(),t.goToMap(e)}}},[i("i",{staticClass:"fa fa-location-arrow",attrs:{"aria-hidden":"true"}}),t._v(" 导航\n            ")])]),t._v(" "),i("div",{staticClass:"addressW"},[i("p",{staticClass:"address"},[i("i",{staticClass:"fa fa-map-marker",staticStyle:{"margin-right":"3px"},attrs:{"aria-hidden":"true"}}),t._v(t._s(t.selectProduct.address)+"\n            ")]),t._v(" "),i("p",[t._v(t._s(t.selectProduct.distanceStr))])]),t._v(" "),i("div",{staticClass:"descW"},[i("div",{staticClass:"desc"},[t._v(t._s(t.selectProduct.desc))]),t._v(" "),i("div",{staticClass:"right"},[i("p",{staticClass:"price"},[t._v("￥"+t._s(t.selectProduct.avgPrice)+"起")]),t._v(" "),i("rater",{attrs:{"font-size":12,"active-color":"#FFA004",disabled:""},model:{value:t.selectProduct.rate,callback:function(e){t.$set(t.selectProduct,"rate",e)},expression:"selectProduct.rate"}}),t._v(" "),i("p",{staticStyle:{"font-size":"12px","line-height":"0","margin-top":"4px","margin-right":"3px"}},[t._v(t._s(t.selectProduct.commentCount)+"人评价")])],1)])]),t._v(" "),i("scroll",{style:{height:t.listHeight},attrs:{bounce:!1,listenScroll:!0,probeType:3},on:{scrollStart:t.scrollStart,scrollEnd:t.scrollEnd,scroll:t.scroll}},[t.userList.length>0?i("div",{staticClass:"user"},[i("div",{staticClass:"title"},[i("p",[t._v("有"),i("b",{staticStyle:{"font-size":"18px"}},[t._v(t._s(t.selectProduct.reserveCount))]),t._v("人将要去")]),t._v(" "),t.userList.length>8?i("p",{staticClass:"more1"},[t._v("更多要去的人"),i("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})]):t._e()]),t._v(" "),i("div",{staticClass:"user-list"},t._l(t.userList,function(e,s){return s<8?i("div",{key:s,staticClass:"item",on:{click:function(i){t.toUSerDetail(e.id)}}},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.headUrl+"-bheader",expression:"item.headUrl + '-bheader'"}],staticClass:"my-head"}),t._v(" "),i("div",{staticClass:"head"},[i("div",{staticStyle:{display:"flex"}},[i("p",{staticClass:"nickname"},[t._v(t._s(e.nickname)+" "),i("img",{staticClass:"sex",attrs:{src:1==e.sex?t.icon.male:t.icon.female}})]),t._v(" "),i("p",{staticStyle:{"font-size":"14px","text-align":"right",width:"80px",color:"#FFA004"}},[t._v(t._s(e.toTime))])]),t._v(" "),i("p",{staticClass:"signature"},[t._v(t._s(e.signature))])])]):t._e()}))]):t._e(),t._v(" "),t.dynamicList.length>0?i("div",{staticClass:"dynamic",staticStyle:{"padding-bottom":"10px"}},[i("div",{staticClass:"title"},[i("p",[i("b",[t._v(t._s(t.selectProduct.dynamicCount))]),t._v("条动态相关")]),t._v(" "),t.dynamicList.length>8?i("p",{staticClass:"more1"},[t._v("更多相关动态"),i("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})]):t._e()]),t._v(" "),i("div",{ref:"dynamicWrapper",attrs:{id:"mapDynamicWrapper"}},[i("waterfall",{attrs:{calHeight:!0,gap:7,imgsArr:t.dynamicList,customWidth:t.itemWidth,wrapperName:"mapDynamicWrapper"},on:{clickItem:t.toDynamicDesc},scopedSlots:t._u([{key:"bottom",fn:function(e){return i("div",{},[i("p",{staticClass:"content"},[e.index<8?i("img",{attrs:{src:t.icon.recommend}}):t._e(),t._v("\n                    "+t._s(e.value.content)+"\n                  ")]),t._v(" "),i("div",{staticClass:"item"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.value.headUrl,expression:"props.value.headUrl"}]}),t._v(" "),i("div",[i("p",[t._v(t._s(e.value.nickname))]),t._v(" "),i("p",{staticClass:"time"},[t._v(t._s(e.value.publishTime))])])])])}}])})],1)]):t._e()]),t._v(" "),i("div",{staticClass:"more",on:{click:function(e){e.stopPropagation(),t.toProductDesc(e)}}},[i("p",[t._v("查看"+t._s(0==t.selectProduct.type?"酒店":"景点")+"详情")]),t._v(" "),i("p",[i("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})])])],1)]):t._e(),t._v(" "),i("tab",{staticClass:"footer",style:{height:42+t.paddingBottom+"px"},attrs:{"line-width":2,"active-color":"#FFA004","bar-active-color":"#FFA004"}},t._l(t.allTypes,function(e){return i("tab-item",{key:e.type,staticClass:"vux-center",attrs:{selected:t.currentType===e.type},on:{"on-item-click":t.changeType}},[t._v(t._s(e.label))])}))],1),t._v(" "),i("actionsheet",{attrs:{menus:t.menusMap,"show-cancel":t.showCancel},on:{"on-click-menu":t.handleClickMenu},model:{value:t.showMap,callback:function(e){t.showMap=e},expression:"showMap"}})],1)},staticRenderFns:[]};var P=i("VU/8")(k,S,!1,function(t){i("yYRz")},null,null);e.default=P.exports},yYRz:function(t,e){}});
//# sourceMappingURL=34.434436a019204e23eb65.js.map