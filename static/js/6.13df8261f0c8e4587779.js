webpackJsonp([6],{"0Iqo":function(t,e){},"9ZqV":function(t,e){},F4PQ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Dd8w"),o=i.n(n),s=i("kMOI"),r=i("GyW3"),a=i("Fwkz"),c=i("UBjx"),l=i("bh5B"),d={name:"editDiv",props:{value:{type:String,default:""},canEdit:{type:Boolean,default:!0}},data:function(){return{innerText:this.value,isLocked:!1}},watch:{value:function(t,e){var i=this;this.innerText=t,this.$nextTick(function(){i.setCaretPosition()})}},methods:{changeText:function(){this.$emit("input",this.$el.innerHTML)},setCaretPosition:function(){var t=this.$refs.editDiv,e=void 0;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())},getCursortPosition:function(){var t,e=this.$refs.editDiv,i=0,n=e.ownerDocument||e.document,o=n.defaultView||n.parentWindow;if(null!=o.getSelection){if((t=o.getSelection()).rangeCount>0){var s=o.getSelection().getRangeAt(0),r=s.cloneRange();r.selectNodeContents(e),r.setEnd(s.endContainer,s.endOffset),i=r.toString().length}}else if((t=n.selection)&&"Control"!==t.type){var a=t.createRange(),c=n.body.createTextRange();c.moveToElementText(e),c.setEndPoint("EndToEnd",a),i=c.text.length}return i}}},u={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"editDiv",staticClass:"edit-div needsclick",attrs:{contenteditable:this.canEdit},domProps:{innerHTML:this._s(this.innerText)},on:{input:this.changeText}})},staticRenderFns:[]};var h=i("VU/8")(d,u,!1,function(t){i("0Iqo")},null,null).exports,m=i("kNDc"),f=i("LgOF"),g=i("TbTt"),p={components:{Grid:m.a,GridItem:f.a,Slider:g.a},data:function(){return{emotionList:[["😂","🙏","😄","😏","😇","😅","😌","😘","😍","🤓","😜","😎","😊","😳","🙄","😱","😒","😔","😷","👿","🤗","😩","😤","😣","😰","😴","😬","😭"],["👻","👍","✌️","👉","👀","🐶","🐷","🤖","⚡️","🔥","🌈","🍏","⚽️","❤️","🚘","🌲","🌚","🌝","🌰","🦁","🐼"]]}},methods:{clickEmotion:function(t){this.$emit("clickEmotion",t)}}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"emotion-grid"},[i("slider",{attrs:{list:t.emotionList,autoPlay:!1,loop:!1}},t._l(t.emotionList,function(e,n){return i("grid",{key:n,attrs:{cols:7}},t._l(e,function(e,n){return i("grid-item",{key:n,nativeOn:{click:function(i){t.clickEmotion(e)}}},[i("div",{staticClass:"item"},[t._v(t._s(e))])])}))}))],1)},staticRenderFns:[]};var x=i("VU/8")(p,v,!1,function(t){i("sYUi"),i("9ZqV")},"data-v-75fb64f2",null).exports,T=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","可爱","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","大兵","奋斗","咒骂","疑问","嘘","晕","折磨","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","示爱","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","挥手","激动","街舞","献吻","左太极","右太极"],w={name:"wechat-emotion",mounted:function(){var t=this,e=this.$el.innerHTML;this.index=T.indexOf(e),this.backgroundPositionX=24*-this.index;var i="";i=this.isGif?'<img src="https://res.wx.qq.com/mpres/htmledition/images/icon/emotion/'+this.index+'.gif">':'<span class="vux-static-emotion" style="background:url(https://res.wx.qq.com/mpres/htmledition/images/icon/emotion/default218877.gif) '+this.backgroundPositionX+'px 0;"></span>',this.$nextTick(function(){t.$el.innerHTML=i})},props:{isGif:Boolean},data:function(){return{src:"",backgroundPositionX:0}}},$={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"vux-emotion"},[this._t("default")],2)},staticRenderFns:[]};var b=i("VU/8")(w,$,!1,function(t){i("sSCK")},null,null).exports,H=i("NYxO"),y={data:function(){return{showEmotion:!0,mainHeight:"",inputContent:"",softHeight:0,statusBarHeight:20,marginBottom:0}},computed:o()({},Object(H.b)(["JIM","chatObject","chatMsgList"])),created:function(){var t=this;this.inputWidth=window.innerWidth-55-24-12,Object(r.c)()?(this.statusBarHeight=44,this.marginBottom=34,this.topHeight=74):this.topHeight=60,window._Native_heightChange=function(e,i){var n=e/window.innerHeight;(e-i)/n<=t.statusBarHeight?(t.softHeight=0,t.$refs.top.$el.style.marginTop="0",Object(r.c)()&&(t.marginBottom=34)):(t.marginBottom=0,Object(r.b)()?t.softHeight=(e-i)/n:t.softHeight=(e-i)/n-t.statusBarHeight,t.showEmotion=!1),t.computedMainHeight()}},mounted:function(){var t=this;this.autoTextarea(63,0),setTimeout(function(){t.showEmotion=!1,t.$nextTick(function(){t.computedMainHeight(!0)})},300)},components:{EditableDiv:h,EmotionGrid:x,VHeader:c.a,Scroll:l.a,Emotion:b},destroyed:function(){this.heightTimer&&clearInterval(this.heightTimer),this.$store.commit("SET_CHAT_OBJECT",{})},methods:{contentFocus:function(t){Object(r.b)()&&(this.$refs.bottom.style.position="fixed");var e=this;this.heightTimer=setInterval(function(){e.computedMainHeight()},200)},contentBlur:function(){clearInterval(this.heightTimer)},computedMainHeight:function(t){var e=this;this.$refs.bottom&&(this.$refs.bottom.style.position="relative",this.$refs.bottom.scrollIntoView(),this.$refs.bottom.scrollIntoViewIfNeeded(),this.$refs.bottom.style.bottom="0",this.mainHeight=window.innerHeight-this.$refs.top.$el.clientHeight-this.$refs.bottom.clientHeight-this.softHeight-this.marginBottom);var i=300;t&&(i=0),this.$nextTick(function(){e.$refs.scroll&&(e.$refs.scroll.$el.style.marginTop=e.$refs.top.$el.clientHeight+"px",setTimeout(function(){e.$refs.scroll&&(e.$refs.scroll.scroll.refresh(),e.$refs.scroll.scroll.scrollTo(0,e.$refs.scroll.scroll.maxScrollY,i))},i))})},sendMessage:function(){if(""!==this.inputContent){var t=this.inputContent;this.inputContent="",this.$refs.textarea.focus();var e=this,i=this.$store.getters.JIM,n=s.b.get();i.sendSingleMsg({target_username:e.chatObject.id,content:t}).onSuccess(function(i){e.$store.dispatch("sendMsg",{id:i.msg_id,type:"to",username:e.chatObject.id,nickname:n.nickname,headUrl:n.headUrl,content:t,contentType:0,sendTime:i.ctime_ms}),a.a.post(e,"/v1/pushAlias",{userId:e.chatObject.id,content:s.b.get("nickname")+": "+t,linkUrl:"/user/focus",messageType:1,targetUrl:"/user"})}).onFail(function(t){e.$vux.toast.text("发送失败","middle")}).onTimeout(function(t){e.$vux.toast.text("发送超时","middle")})}},toggoleEmotion:function(){this.showEmotion=!this.showEmotion},clickEmotion:function(t){this.inputContent+=t},autoTextarea:function(t,e){var i=this.$refs.textarea;e=e||0;var n=!!document.getBoxObjectFor||"mozInnerScreenX"in window,o=!!window.opera&&!!window.opera.toString().indexOf("Opera"),s=function(t,e){i.addEventListener?i.addEventListener(t,e,!1):i.attachEvent("on"+t,e)},r=i.currentStyle?function(t){var e=i.currentStyle[t];if("height"===t&&1!==e.search(/px/i)){var n=i.getBoundingClientRect();return n.bottom-n.top-parseFloat(r("paddingTop"))-parseFloat(r("paddingBottom"))+"px"}return e}:function(t){return getComputedStyle(i,null)[t]};i.style.resize="none";var a=function(){var s=void 0,a=0,c=i.style;i._length!==i.value.length&&(i._length=i.value.length,n||o||(a=parseInt(r("paddingTop"))+parseInt(r("paddingBottom"))),i.style.height="26px",i.scrollHeight>26&&(t&&i.scrollHeight>t?(s=t-a,c.overflowY="visible"):(s=i.scrollHeight-a,c.overflowY="hidden"),c.height=s+e+"px",i.currHeight=parseInt(c.height)))};s("propertychange",a),s("input",a),s("focus",a),a()}},watch:{chatMsgList:function(t,e){var i=this;t.forEach(function(e,n){i.moment().diff(i.moment(e.sendTime),"days")<=1?e.sendTimeStr=i.moment(e.sendTime).format("HH:mm"):e.sendTimeStr=i.moment(e.sendTime).format("YYYY-MM-DD HH:mm"),n>0&&i.moment(e.sendTime).diff(i.moment(t[n-1].sendTime),"minutes")<4&&(e.sendTimeStr="")})},showEmotion:function(){var t=this;this.$nextTick(function(){t.computedMainHeight()})}}},C={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat-wrapper"},[i("v-header",{ref:"top",attrs:{title:t.chatObject.nickname,fixed:!0}}),t._v(" "),i("scroll",{ref:"scroll",staticStyle:{overflow:"hidden"},style:{height:t.mainHeight+"px",marginTop:t.topHeight+"px"},attrs:{data:t.chatMsgList}},[i("ul",{staticClass:"message"},t._l(t.chatMsgList,function(e){return i("li",{key:e.id,class:e.type},[""!==e.sendTimeStr?i("p",{staticClass:"time"},[i("span",[t._v(t._s(e.sendTimeStr))])]):t._e(),t._v(" "),i("div",{staticClass:"main"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.headUrl,expression:"msg.headUrl"}],staticClass:"avatar"}),t._v(" "),i("div",{staticClass:"text",domProps:{innerHTML:t._s(e.content)}})])])}))]),t._v(" "),i("div",{ref:"bottom",staticClass:"bottom"},[i("div",{staticStyle:{display:"flex"}},[i("div",{staticClass:"input",style:{width:t.inputWidth+"px"}},[i("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.inputContent,expression:"inputContent",modifiers:{trim:!0}}],ref:"textarea",domProps:{value:t.inputContent},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.sendMessage(e)},focus:t.contentFocus,blur:[t.contentBlur,function(e){t.$forceUpdate()}],input:function(e){e.target.composing||(t.inputContent=e.target.value.trim())}}}),t._v(" "),i("i",{staticClass:"fa fa-smile-o emoji",attrs:{"aria-hidden":"true"},on:{click:function(e){e.stopPropagation(),t.toggoleEmotion(e)}}})]),t._v(" "),i("p",{staticClass:"send",on:{click:t.sendMessage}},[t._v("发送")])]),t._v(" "),i("emotion-grid",{directives:[{name:"show",rawName:"v-show",value:t.showEmotion,expression:"showEmotion"}],staticStyle:{"margin-top":"7px"},on:{clickEmotion:t.clickEmotion}})],1)],1)},staticRenderFns:[]};var _=i("VU/8")(y,C,!1,function(t){i("kTHg")},"data-v-d98e1b2c",null);e.default=_.exports},kTHg:function(t,e){},sSCK:function(t,e){},sYUi:function(t,e){}});
//# sourceMappingURL=6.13df8261f0c8e4587779.js.map